{"title":"python定时任务","slug":"python定时任务","date":"2023-06-12T07:01:00.000Z","updated":"2023-10-25T09:23:13.676Z","comments":true,"path":"api/articles/python定时任务.json","photos":[],"link":"","excerpt":"apscheduler定时任务","covers":null,"content":"<h1 id=\"apscheduler定时任务\"><a href=\"#apscheduler定时任务\" class=\"headerlink\" title=\"apscheduler定时任务\"></a>apscheduler定时任务</h1><span id=\"more\"></span>\n\n<p>导入</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">import apscheduler</span><br><span class=\"line\">from apscheduler.schedulers.background import BackgroundScheduler</span><br><span class=\"line\">from apscheduler.triggers.cron import CronTrigger</span><br></pre></td></tr></table></figure>\n\n<h1 id=\"触发器（trigger）\"><a href=\"#触发器（trigger）\" class=\"headerlink\" title=\"触发器（trigger）\"></a>触发器（trigger）</h1><p>interval: 固定时间间隔触发<br>date: 特定的时间点触发<br>cron: 在特定时间周期性地触发</p>\n<h1 id=\"interval-间隔调度（每隔多久执行）\"><a href=\"#interval-间隔调度（每隔多久执行）\" class=\"headerlink\" title=\"interval 间隔调度（每隔多久执行）\"></a>interval 间隔调度（每隔多久执行）</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 属性</span><br><span class=\"line\">weeks (int) – number of weeks to wait</span><br><span class=\"line\">days (int) – number of days to wait</span><br><span class=\"line\">hours (int) – number of hours to wait</span><br><span class=\"line\">minutes (int) – number of minutes to wait</span><br><span class=\"line\">seconds (int) – number of seconds to wait</span><br><span class=\"line\">start_date (datetime|str) – starting point for the interval calculation</span><br><span class=\"line\">end_date (datetime|str) – latest possible date/time to trigger on</span><br><span class=\"line\">timezone (datetime.tzinfo|str) – time zone to use for the date/time calculations</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"># 实例</span><br><span class=\"line\">sched.add_job(my_job, &#x27;interval&#x27;, days=03, hours=17, minutes=19, seconds=07)</span><br><span class=\"line\">#间隔3秒钟执行一次</span><br><span class=\"line\">scheduler.add_job(job3, &#x27;interval&#x27;, seconds=3)</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"date-定时调度（作业只会执行一次）\"><a href=\"#date-定时调度（作业只会执行一次）\" class=\"headerlink\" title=\"date 定时调度（作业只会执行一次）\"></a>date 定时调度（作业只会执行一次）</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"># 属性</span><br><span class=\"line\">run_date (datetime|str) – the date/time to run the job at  -（任务开始的时间）</span><br><span class=\"line\">timezone (datetime.tzinfo|str) – time zone for run_date if it doesn’t have one already</span><br><span class=\"line\"></span><br><span class=\"line\"># 实例</span><br><span class=\"line\">scheduler.add_job(tick, &#x27;date&#x27;, run_date=&#x27;2016-02-14 15:01:05&#x27;)　　</span><br><span class=\"line\"># The job will be executed on November 6th, 2009</span><br><span class=\"line\">sched.add_job(my_job, &#x27;date&#x27;, run_date=date(2009, 11, 6), args=[&#x27;text&#x27;])</span><br><span class=\"line\"># The job will be executed on November 6th, 2009 at 16:30:05</span><br><span class=\"line\">sched.add_job(my_job, &#x27;date&#x27;, run_date=datetime(2009, 11, 6, 16, 30, 5), args=[&#x27;text&#x27;])</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"cron定时调度（某一定时时刻执行）\"><a href=\"#cron定时调度（某一定时时刻执行）\" class=\"headerlink\" title=\"cron定时调度（某一定时时刻执行）\"></a>cron定时调度（某一定时时刻执行）</h1><figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">#属性</span><br><span class=\"line\">(int|str) 表示参数既可以是int类型，也可以是str类型</span><br><span class=\"line\">(datetime | str) 表示参数既可以是datetime类型，也可以是str类型</span><br><span class=\"line\"> </span><br><span class=\"line\">year (int|str) – 4-digit year -（表示四位数的年份，如2008年）</span><br><span class=\"line\">month (int|str) – month (1-12) -（表示取值范围为1-12月）</span><br><span class=\"line\">day (int|str) – day of the (1-31) -（表示取值范围为1-31日）</span><br><span class=\"line\">week (int|str) – ISO week (1-53) -（格里历2006年12月31日可以写成2006年-W52-7（扩展形式）或2006W527（紧凑形式））</span><br><span class=\"line\">day_of_week (int|str) – number or name of weekday (0-6 or mon,tue,wed,thu,fri,sat,sun) - （表示一周中的第几天，既可以用0-6表示也可以用其英语缩写表示）</span><br><span class=\"line\">hour (int|str) – hour (0-23) - （表示取值范围为0-23时）</span><br><span class=\"line\">minute (int|str) – minute (0-59) - （表示取值范围为0-59分）</span><br><span class=\"line\">second (int|str) – second (0-59) - （表示取值范围为0-59秒）</span><br><span class=\"line\">start_date (datetime|str) – earliest possible date/time to trigger on (inclusive) - （表示开始时间）</span><br><span class=\"line\">end_date (datetime|str) – latest possible date/time to trigger on (inclusive) - （表示结束时间）</span><br><span class=\"line\">timezone (datetime.tzinfo|str) – time zone to use for the date/time calculations (defaults to scheduler timezone) -（表示时区取值）</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\">#实例   </span><br><span class=\"line\">#表示2017年3月22日17时19分07秒执行该程序</span><br><span class=\"line\">sched.add_job(my_job, &#x27;cron&#x27;, year=2017,month = 03,day = 22,hour = 17,minute = 19,second = 07)</span><br><span class=\"line\">  </span><br><span class=\"line\">#表示任务在6,7,8,11,12月份的第三个星期五的00:00,01:00,02:00,03:00 执行该程序</span><br><span class=\"line\">sched.add_job(my_job, &#x27;cron&#x27;, month=&#x27;6-8,11-12&#x27;, day=&#x27;3rd fri&#x27;, hour=&#x27;0-3&#x27;)</span><br><span class=\"line\">  </span><br><span class=\"line\">#表示从星期一到星期五5:30（AM）直到2014-05-30 00:00:00</span><br><span class=\"line\">sched.add_job(my_job(), &#x27;cron&#x27;, day_of_week=&#x27;mon-fri&#x27;, hour=5, minute=30,end_date=&#x27;2014-05-30&#x27;)</span><br><span class=\"line\">  </span><br><span class=\"line\">#表示每5秒执行该程序一次，相当于interval 间隔调度中seconds = 5</span><br><span class=\"line\">sched.add_job(my_job, &#x27;cron&#x27;,second = &#x27;*/5&#x27;)</span><br></pre></td></tr></table></figure>\n\n\n<h1 id=\"符号\"><a href=\"#符号\" class=\"headerlink\" title=\"符号\"></a>符号</h1><p>(*)星号：可以理解为每的意思，每秒，每分，每天，每月，每年…<br>(?)问号：问号只能出现在日期和星期这两个位置，表示这个位置的值不确定，每天3点执行，所以第六位星期的位置，我们是不需要关注的，<br>就是不确定的值。同时：日期和星期是两个相互排斥的元素，通过问号来表明不指定值。比如，1月10日，比如是星期1，如果在星期的位置是另指定星期二，<br>就前后冲突矛盾了。<br>(-)减号：表达一个范围，如在小时字段中使用“10-12”，则表示从10到12点，即10,11,12<br>(,)逗号：表达一个列表值，如在星期字段中使用“1,2,4”，则表示星期一，星期二，星期四<br>(&#x2F;)斜杠：如：x&#x2F;y，x是开始值，y是步长，比如在第一位（秒） 0&#x2F;15就是，从0秒开始，每15秒，最后就是0，15，30，45，60    另：&#x2F;y，等同于0&#x2F;y</p>\n","categories":[{"name":"程序员","slug":"程序员","count":1,"path":"api/categories/程序员.json"},{"name":"python","slug":"程序员/python","count":1,"path":"api/categories/程序员/python.json"}],"tags":[{"name":"python","slug":"python","count":1,"path":"api/tags/python.json"},{"name":"程序员","slug":"程序员","count":1,"path":"api/tags/程序员.json"}]}